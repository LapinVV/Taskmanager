<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="Course_work.AddTaskPage"
    BackgroundColor="#FFFFFF"
    Padding="0">

    <ContentPage.Resources>
        <ResourceDictionary>

            <Style x:Key="TitleEntryBorderStyle" TargetType="Border">
                <Setter Property="Stroke" Value="#CCCCCC" />
                <Setter Property="StrokeThickness" Value="2" />

                <Style.Triggers>

                    <DataTrigger TargetType="Border"
                                 Binding="{Binding SelectedPriority}"
                                 Value="HighUrgent">
                        <Setter Property="Stroke" Value="#d55043" />
                    </DataTrigger>

                    <DataTrigger TargetType="Border"
                                 Binding="{Binding SelectedPriority}"
                                 Value="High">
                        <Setter Property="Stroke" Value="#FFF09515" />
                    </DataTrigger>

                    <DataTrigger TargetType="Border"
                                 Binding="{Binding SelectedPriority}"
                                 Value="Urgent">
                        <Setter Property="Stroke" Value="#FFBD59" />
                    </DataTrigger>

                    <DataTrigger TargetType="Border"
                                 Binding="{Binding SelectedPriority}"
                                 Value="Low">
                        <Setter Property="Stroke" Value="#999999" />
                    </DataTrigger>

                    <DataTrigger TargetType="Border"
                                 Binding="{Binding SelectedPriority}"
                                 Value="{x:Null}">
                        <Setter Property="Stroke" Value="#CCCCCC" />
                    </DataTrigger>

                </Style.Triggers>
            </Style>

        </ResourceDictionary>
    </ContentPage.Resources>


    <Grid RowDefinitions="Auto,*">

        <!-- Header -->
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Padding="0,10">
            <Label Text="–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É"
                   FontSize="28"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   TextColor="Black"/>
            <Button Grid.Column="1"
                    BackgroundColor="Transparent"
                    Padding="0"
                    Margin="10,0,10,0"
                    Clicked="OnCloseTapped">
                <Button.ImageSource>
                    <FontImageSource Glyph="‚úï" Color="#777777" Size="28"/>
                </Button.ImageSource>
            </Button>
        </Grid>

        <!-- Scroll Content -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="12" Padding="20">

                <Border BackgroundColor="#ffffff"
                        Style="{StaticResource TitleEntryBorderStyle}"
                        StrokeShape="RoundRectangle 8"
                        Padding="0"
                        HeightRequest="55">

                    <Entry x:Name="TitleEntry"
                           Placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:"
                           FontSize="20"
                           BackgroundColor="Transparent"
                           TextColor="Black"
                           HorizontalOptions="FillAndExpand"
                           VerticalOptions="Center"
                           Margin="12,0"/>
                </Border>

                <Label x:Name="PickedDateLabel"
                       Text=""
                       FontSize="14"
                       TextColor="Black"
                       IsVisible="False"
                       HorizontalOptions="Center"
                       HorizontalTextAlignment="Center" />

                <Border BackgroundColor="#f5f5f5"
                        StrokeThickness="0"
                        StrokeShape="RoundRectangle 8"
                        HeightRequest="130">
                    <Editor x:Name="DescriptionEditor"
                            Placeholder="–î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ..."
                            FontSize="18"
                            BackgroundColor="Transparent"
                            TextColor="Black"
                            Margin="12,5"
                            AutoSize="TextChanges"/>
                </Border>

                <!-- Buttons Row -->
                <Grid ColumnSpacing="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <Button Text="–í—Ä–µ–º—è"
                            Grid.Column="0"
                            x:Name="DateButton"
                            BackgroundColor="#ffbd59"
                            TextColor="White"
                            CornerRadius="15"
                            HeightRequest="50"
                            Clicked="OnDateClicked"/>

                    <Button Text="–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç"
                            Grid.Column="1"
                            x:Name="PriorityButton"
                            BackgroundColor="#d55043"
                            TextColor="White"
                            CornerRadius="15"
                            HeightRequest="55"
                            Clicked="OnPriorityClicked"/>

                    <Button Text="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
                            Grid.Column="2"
                            x:Name="ReminderButton"
                            BackgroundColor="#0097b2"
                            TextColor="White"
                            CornerRadius="15"
                            HeightRequest="55"
                            Clicked="OnReminderClicked"/>
                </Grid>

                <Button Text="–î–æ–±–∞–≤–∏—Ç—å"
                        BackgroundColor="#468966"
                        TextColor="White"
                        FontSize="22"
                        CornerRadius="20"
                        HeightRequest="48"
                        Margin="0,10,0,0"
                        Clicked="OnAddTaskConfirm"/>
            </VerticalStackLayout>
        </ScrollView>

        <!-- POPUP OVERLAY -->
        <Grid Grid.RowSpan="2"
              x:Name="PopupOverlay"
              IsVisible="False"
              BackgroundColor="#80000000"
              HorizontalOptions="Fill"
              VerticalOptions="Fill"
              Padding="0"
              ZIndex="50">

            <Grid HorizontalOptions="Center"
                  VerticalOptions="Center"
                  WidthRequest="320">

                <!-- PRIORITY POPUP -->
                <Border x:Name="PriorityPopup"
                        BackgroundColor="White"
                        StrokeShape="RoundRectangle 18"
                        Padding="18"
                        IsVisible="False">

                    <VerticalStackLayout Spacing="14">
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Text="Select Priority"
                                   FontSize="20"
                                   HorizontalOptions="FillAndExpand"
                                   HorizontalTextAlignment="Center"
                                   VerticalOptions="Center"/>

                            <Button Grid.Column="1"
                                    BackgroundColor="Transparent"
                                    Padding="0"
                                    Clicked="OnClosePriorityPopup">
                                <Button.ImageSource>
                                    <FontImageSource Glyph="‚úï" Color="#444" Size="22"/>
                                </Button.ImageSource>
                            </Button>
                        </Grid>

                        <Button Text="–í–∞–∂–Ω–æ –∏ —Å—Ä–æ—á–Ω–æ"
                                BackgroundColor="#d55043"
                                TextColor="White"
                                CornerRadius="10"
                                HeightRequest="45"
                                Clicked="OnPrioritySelected"
                                CommandParameter="HighUrgent"/>

                        <Button Text="–í–∞–∂–Ω–æ –∏ –Ω–µ —Å—Ä–æ—á–Ω–æ"
                                BackgroundColor="#FFF09515"
                                TextColor="White"
                                CornerRadius="10"
                                HeightRequest="45"
                                Clicked="OnPrioritySelected"
                                CommandParameter="High"/>

                        <Button Text="–ù–µ –≤–∞–∂–Ω–æ –∏ —Å—Ä–æ—á–Ω–æ"
                                BackgroundColor="#FFFCCC3C"
                                TextColor="White"
                                CornerRadius="10"
                                HeightRequest="45"
                                Clicked="OnPrioritySelected"
                                CommandParameter="Urgent"/>

                        <Button Text="–ù–µ –≤–∞–∂–Ω–æ –∏ –Ω–µ —Å—Ä–æ—á–Ω–æ"
                                BackgroundColor="#cccccc"
                                TextColor="Black"
                                CornerRadius="10"
                                HeightRequest="45"
                                Clicked="OnPrioritySelected"
                                CommandParameter="Low"/>
                    </VerticalStackLayout>
                </Border>

                <!-- DATE POPUP -->
                <Border x:Name="DatePopupOverlay"
                        BackgroundColor="White"
                        StrokeShape="RoundRectangle 18"
                        Padding="18"
                        IsVisible="False">

                    <VerticalStackLayout Spacing="12">

                        <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,4">
                            <Label Text="Select Date"
                                   FontSize="20"
                                   HorizontalOptions="FillAndExpand"
                                   HorizontalTextAlignment="Center"
                                   VerticalOptions="Center"/>
                            <Button Grid.Column="1"
                                    BackgroundColor="Transparent"
                                    Padding="0"
                                    Clicked="OnCloseDatePopup">
                                <Button.ImageSource>
                                    <FontImageSource Glyph="‚úï" Color="#444" Size="22"/>
                                </Button.ImageSource>
                            </Button>
                        </Grid>

                        <Button Text="–°–µ–≥–æ–¥–Ω—è"
                                BackgroundColor="#468966"
                                TextColor="White"
                                CornerRadius="10"
                                HeightRequest="45"
                                Clicked="OnSelectToday"/>

                        <Button Text="–ó–∞–≤—Ç—Ä–∞"
                                BackgroundColor="#F0AD4E"
                                TextColor="Black"
                                CornerRadius="10"
                                HeightRequest="45"
                                Clicked="OnSelectTomorrow"/>

                        <Button Text="–°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è"
                                BackgroundColor="#D9534F"
                                TextColor="White"
                                CornerRadius="10"
                                HeightRequest="45"
                                Clicked="OnSelectNextWeek"/>

                        <Button Text="–ë–µ–∑ —Å—Ä–æ–∫–∞"
                                BackgroundColor="#BDBDBD"
                                TextColor="Black"
                                CornerRadius="10"
                                HeightRequest="45"
                                Clicked="OnSelectNoDate"/>

                        <DatePicker x:Name="CustomDatePicker"
                                    DateSelected="OnCustomDatePicked"
                                    HorizontalOptions="Center"
                                    WidthRequest="220"/>

                        <TimePicker x:Name="CustomTimePicker"
                                    Format="HH:mm"
                                    PropertyChanged="OnCustomTimePropertyChanged"
                                    HorizontalOptions="Center"
                                    WidthRequest="220"/>

                    </VerticalStackLayout>
                </Border>

                <!-- üîî REMINDER POPUP -->
                <Border x:Name="ReminderPopup"
                        BackgroundColor="White"
                        StrokeShape="RoundRectangle 18"
                        Padding="18"
                        IsVisible="False">

                    <VerticalStackLayout Spacing="14">

                        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Text="–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è"
                                   FontSize="20"
                                   HorizontalTextAlignment="Center"
                                   VerticalOptions="Center" />

                            <Button Grid.Column="1"
                                    BackgroundColor="Transparent"
                                    Padding="0"
                                    Clicked="OnCloseReminderPopup">
                                <Button.ImageSource>
                                    <FontImageSource Glyph="‚úï" Color="#444" Size="22"/>
                                </Button.ImageSource>
                            </Button>
                        </Grid>

                        <Border BackgroundColor="#f5f5f5"
                                StrokeShape="RoundRectangle 8"
                                Padding="12"
                                Margin="0,0,0,10">
                            <Label x:Name="EventDateTimeLabel"
                                   FontSize="16"
                                   TextColor="#333"
                                   HorizontalOptions="Center"
                                   Text="–°–æ–±—ã—Ç–∏–µ: --.--.---- –≤ --:--"/>
                        </Border>

                        <VerticalStackLayout Spacing="8">
                            <!-- –ù–µ –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å -->
                            <Button Text="–ù–µ –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å"
                                    BackgroundColor="#EEEEEE"
                                    TextColor="#333"
                                    CornerRadius="10"
                                    HeightRequest="40"
                                    Clicked="OnReminderPresetSelected"
                                    CommandParameter="None"/>

                            <!-- –í–æ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ -->
                            <Button Text="–í–æ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞"
                                    BackgroundColor="#EEEEEE"
                                    TextColor="#333"
                                    CornerRadius="10"
                                    HeightRequest="40"
                                    Clicked="OnReminderPresetSelected"
                                    CommandParameter="0"/>

                            <!-- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã -->
                            <Button Text="–ó–∞ 5 –º–∏–Ω—É—Ç –¥–æ —Å–æ–±—ã—Ç–∏—è"
                                    BackgroundColor="#EEEEEE"
                                    TextColor="#333"
                                    CornerRadius="10"
                                    HeightRequest="40"
                                    Clicked="OnReminderPresetSelected"
                                    CommandParameter="5"/>

                            <Button Text="–ó–∞ 10 –º–∏–Ω—É—Ç –¥–æ —Å–æ–±—ã—Ç–∏—è"
                                    BackgroundColor="#EEEEEE"
                                    TextColor="#333"
                                    CornerRadius="10"
                                    HeightRequest="40"
                                    Clicked="OnReminderPresetSelected"
                                    CommandParameter="10"/>

                            <Button Text="–ó–∞ 15 –º–∏–Ω—É—Ç –¥–æ —Å–æ–±—ã—Ç–∏—è"
                                    BackgroundColor="#EEEEEE"
                                    TextColor="#333"
                                    CornerRadius="10"
                                    HeightRequest="40"
                                    Clicked="OnReminderPresetSelected"
                                    CommandParameter="15"/>

                            <Button Text="–ó–∞ 30 –º–∏–Ω—É—Ç –¥–æ —Å–æ–±—ã—Ç–∏—è"
                                    BackgroundColor="#EEEEEE"
                                    TextColor="#333"
                                    CornerRadius="10"
                                    HeightRequest="40"
                                    Clicked="OnReminderPresetSelected"
                                    CommandParameter="30"/>

                            <Button Text="–ó–∞ 1 —á–∞—Å –¥–æ —Å–æ–±—ã—Ç–∏—è"
                                    BackgroundColor="#EEEEEE"
                                    TextColor="#333"
                                    CornerRadius="10"
                                    HeightRequest="40"
                                    Clicked="OnReminderPresetSelected"
                                    CommandParameter="60"/>

                            <Button Text="–ó–∞ 1 –¥–µ–Ω—å –¥–æ —Å–æ–±—ã—Ç–∏—è"
                                    BackgroundColor="#EEEEEE"
                                    TextColor="#333"
                                    CornerRadius="10"
                                    HeightRequest="40"
                                    Clicked="OnReminderPresetSelected"
                                    CommandParameter="1440"/>

                            <Button Text="–ó–∞ 2 –¥–Ω—è –¥–æ —Å–æ–±—ã—Ç–∏—è"
                                    BackgroundColor="#EEEEEE"
                                    TextColor="#333"
                                    CornerRadius="10"
                                    HeightRequest="40"
                                    Clicked="OnReminderPresetSelected"
                                    CommandParameter="2880"/>

                            <Button Text="–ó–∞ 1 –Ω–µ–¥–µ–ª—é –¥–æ —Å–æ–±—ã—Ç–∏—è"
                                    BackgroundColor="#EEEEEE"
                                    TextColor="#333"
                                    CornerRadius="10"
                                    HeightRequest="40"
                                    Clicked="OnReminderPresetSelected"
                                    CommandParameter="10080"/>

                            <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å -->
                            <Button Text="–ù–∞—Å—Ç—Ä–æ–∏—Ç—å"
                                    BackgroundColor="#0097b2"
                                    TextColor="White"
                                    CornerRadius="10"
                                    HeightRequest="45"
                                    Margin="0,10,0,0"
                                    Clicked="OnOpenCustomReminder"/>
                        </VerticalStackLayout>

                    </VerticalStackLayout>
                </Border>

                <!-- üõ† CUSTOM REMINDER POPUP -->
                <Border x:Name="CustomReminderPopup"
                        BackgroundColor="White"
                        StrokeShape="RoundRectangle 18"
                        Padding="18"
                        IsVisible="False"
                        WidthRequest="300">

                    <VerticalStackLayout Spacing="14">

                        <Grid ColumnDefinitions="*,Auto">
                            <Label Text="–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"
                                   FontSize="20"
                                   HorizontalTextAlignment="Center"
                                   VerticalOptions="Center" />

                            <Button Grid.Column="1"
                                    BackgroundColor="Transparent"
                                    Padding="0"
                                    Clicked="OnCloseCustomReminderPopup">
                                <Button.ImageSource>
                                    <FontImageSource Glyph="‚úï" Color="#444" Size="22"/>
                                </Button.ImageSource>
                            </Button>
                        </Grid>

                        <Border BackgroundColor="#f5f5f5"
                                StrokeShape="RoundRectangle 8"
                                Padding="12">
                            <VerticalStackLayout Spacing="8">
                                <Label Text="–ó–∞ —Å–∫–æ–ª—å–∫–æ –¥–æ —Å–æ–±—ã—Ç–∏—è?"
                                       FontSize="14"
                                       TextColor="#333"/>

                                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                                    <Entry x:Name="CustomMinutesEntry"
                                           Placeholder="–ú–∏–Ω—É—Ç—ã"
                                           Keyboard="Numeric"
                                           FontSize="16"
                                           BackgroundColor="White"/>

                                    <!-- ‚≠ê –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –°–¢–†–û–ö–ê: –¥–æ–±–∞–≤–ª–µ–Ω SelectedIndexChanged -->
                                    <Picker x:Name="TimeUnitPicker"
                                            Grid.Column="1"
                                            WidthRequest="100"
                                            SelectedIndexChanged="OnTimeUnitChanged">
                                        <Picker.Items>
                                            <x:String>–º–∏–Ω—É—Ç</x:String>
                                            <x:String>—á–∞—Å–æ–≤</x:String>
                                            <x:String>–¥–Ω–µ–π</x:String>
                                        </Picker.Items>
                                    </Picker>
                                </Grid>
                            </VerticalStackLayout>
                        </Border>

                        <Button Text="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
                                BackgroundColor="#0097b2"
                                TextColor="White"
                                CornerRadius="10"
                                HeightRequest="45"
                                Clicked="OnConfirmCustomReminder"/>
                    </VerticalStackLayout>
                </Border>

            </Grid>
        </Grid>
    </Grid>
</ContentPage>