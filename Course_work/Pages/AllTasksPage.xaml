<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:conv="clr-namespace:Course_work.Converters"
    xmlns:models="clr-namespace:Course_work.Models"
    xmlns:pop="clr-namespace:Course_work.Pages.Popups"
    x:Class="Course_work.Pages.AllTasksPage"
    Title="Все задачи"
    BackgroundColor="White">

    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:NullToBoolConverter x:Key="NullToBoolConverter" />
            <conv:BoolToAccentConverter x:Key="BoolToAccentConverter" />
            <conv:PriorityToColorConverter x:Key="PriorityToColorConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>

        <!-- СПИСОК ЗАДАЧ -->
        <CollectionView x:Name="TasksList"
                        ItemsLayout="VerticalList"
                        SelectionMode="None"
                        Margin="10">

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:TodoItem">

                    <Grid Padding="10"
                          ColumnDefinitions="40, *"
                          RowDefinitions="Auto">

                        <!-- КРУЖОК ДЛЯ ОТМЕТКИ ЗАДАЧИ -->
                        <Ellipse WidthRequest="28"
                                 HeightRequest="28"
                                 Stroke="{Binding Priority, Converter={StaticResource PriorityToColorConverter}}"
                                 StrokeThickness="3"
                                 Fill="Transparent">

                            <Ellipse.GestureRecognizers>
                                <TapGestureRecognizer
                                    Command="{Binding Source={x:Reference TasksList}, Path=BindingContext.CompleteTaskCommand}"
                                    CommandParameter="{Binding .}" />
                            </Ellipse.GestureRecognizers>

                        </Ellipse>


                        <!-- ЗОНА КЛИКА ДЛЯ ОТКРЫТИЯ POPUP -->
                        <Grid Grid.Column="1">
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer
                                    Command="{Binding Source={x:Reference TasksList}, Path=BindingContext.OpenTaskCommand}"
                                    CommandParameter="{Binding .}" />
                            </Grid.GestureRecognizers>

                            <VerticalStackLayout Spacing="4" Padding="12,0">

                                <Label Text="{Binding Title}"
                                       FontSize="20"
                                       TextColor="#111" />

                                <Label Text="{Binding Description}"
                                       FontSize="14"
                                       TextColor="#777777" />

                                <Label Text="{Binding DateDisplay}"
                                       FontSize="13"
                                       HorizontalOptions="Start"
                                       TextColor="{Binding DateColor}"
                                       IsVisible="{Binding DateDisplay, Converter={StaticResource NullToBoolConverter}}" />

                            </VerticalStackLayout>

                        </Grid>

                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>


        <!-- ВСПЛЫВАЮЩЕЕ ОКНО ПРОСМОТРА ЗАДАЧИ -->
        <pop:ViewTaskPopup x:Name="TaskPopup"
                           IsVisible="False"/>

    </Grid>

</ContentPage>